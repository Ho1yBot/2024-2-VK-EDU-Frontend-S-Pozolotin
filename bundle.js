!function(e){var t={};function n(a){if(t[a])return t[a].exports;var c=t[a]={i:a,l:!1,exports:{}};return e[a].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)n.d(a,c,function(t){return e[t]}.bind(null,c));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);function a(e,t){var n=JSON.parse(localStorage.getItem("messages_".concat(e)))||[];n.push(t),localStorage.setItem("messages_".concat(e),JSON.stringify(n))}function c(e){return JSON.parse(localStorage.getItem("messages_".concat(e)))||[]}function o(e){localStorage.removeItem("messages_".concat(e)),document.querySelector('[data-currentChat="'.concat(e,'"]')).textContent="Нет сообщений"}function i(e){e.preventDefault();var t=document.querySelector(".form-input"),n=t.value.trim();if(n){var c={text:n,sender:"Вы",time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},o=localStorage.getItem("currentChat");a(o,c),l(c),r(o,c),t.value="";var i=document.querySelector(".chat-window");i&&(i.scrollTop=i.scrollHeight)}}function r(e,t){var n=document.querySelector('.chat-item[data-chat-id="'.concat(e,'"]'));if(n){var a=n.querySelector(".chat-info div"),c=n.querySelector(".chat-time span");a&&c&&(t?(t.isImage||t.content&&t.type?a.textContent="".concat(t.name):t.text?a.textContent=t.text:a.textContent="Нет сообщений",c.textContent=t.time||""):(a.textContent="Нет сообщений",c.textContent=""))}}function s(e){if("Enter"===e.key&&!e.shiftKey){e.preventDefault();var t=new Event("submit",{cancelable:!0}),n=document.querySelector("form");n&&n.dispatchEvent(t)}}function l(e,t){var n=document.createElement("div");n.classList.add("message-container");var a=document.createElement("div");a.classList.add("message-sender"),a.textContent=e.sender||"Вы";var c=document.createElement("div");c.classList.add("message-time"),c.textContent=e.time;var o=document.createElement("div");if(o.classList.add("message-content"),e.isImage){var i=document.createElement("img");i.src=e.content,i.alt=e.name,i.classList.add("message-image"),o.appendChild(i)}else if(e.content&&e.type){var r=document.createElement("a");r.href=e.content,r.textContent=e.name,r.download=e.name,o.appendChild(r)}else o.textContent=e.text||"";n.appendChild(a),n.appendChild(o),n.appendChild(c),t.appendChild(n),t.scrollTop=t.scrollHeight}var d=document.createElement("input");function u(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(){var e=m(),a={name:t.name,content:n.result,type:t.type,time:(new Date).toLocaleTimeString(),isImage:t.type.startsWith("image/")},c=JSON.parse(localStorage.getItem("messages_".concat(e)))||[];c.push(a),localStorage.setItem("messages_".concat(e),JSON.stringify(c)),l(c[c.length-1]),r(e,a)},n.readAsDataURL(t)}}function m(){return localStorage.getItem("currentChat")}d.type="file",d.style.display="none";var g,v=document.getElementById("header-component"),f=document.getElementById("chat-list-component"),p=document.getElementById("floating-button-component");function y(){c().forEach(l)}v.appendChild(function(){var e=document.createElement("div");e.classList.add("header","center"),e.innerHTML='<button class="header_burger-menu"><img src="./static/images/burger-menu.svg" alt="Кнопка меню"></button>\n        <button class="header_title">\n            <div class="header_title-text">Messanger</div>\n        </button>\n        <nav class="header_nav">\n            <button class="header_search"><img src="./static/images/search-icon.svg" alt="Search"></button>\n            <button id="menu-button" style="display: none;"><img src="./static/images/menu-dots.svg" alt="Меню"></button>\n            <div id="menu-container" class="menu-container hidden"> \n                <ul class="menu_list">\n                    <li class="menu_item"><button>Info</button></li>\n                    <li class="menu_item"><button>Mute</button></li>\n                    <li class="menu_item"><button id="clear-local-storage">Clear messages</button></li>\n                </ul>\n            </div>\n        </nav>';var t=e.querySelector("#menu-button"),n=e.querySelector("#menu-container"),a=e.querySelector("#clear-local-storage");return t.addEventListener("click",(function(){n.classList.toggle("hidden")})),document.addEventListener("click",(function(e){t.contains(e.target)||n.contains(e.target)||n.classList.add("hidden")})),a.addEventListener("click",(function(){var e;o(m()),(e=document.querySelector(".messages-container"))&&(e.innerHTML=""),n.classList.add("hidden")})),e}()),f.appendChild(function(){d.addEventListener("change",u);var e=document.createElement("div");e.classList.add("chat-container");var t=null;function n(){document.querySelector(".chat-window").remove(),document.getElementById("chat-list-component").style.display="flex",document.querySelector(".header_title-text").textContent="Messenger",document.getElementById("menu-button").style.display="none";var e=document.getElementById("floating-button-component");e&&(e.style.display="block")}return[{id:1,avatar:"./static/images/user-icon.svg",title:"Чат с Андреем",lastMessage:"",time:"14:23",isRead:!0},{id:2,avatar:"./static/images/user-icon.svg",title:"Чат с Max",lastMessage:"",time:"14:23",isRead:!0},{id:3,avatar:"./static/images/user-icon.svg",title:"Чат с Андреем",lastMessage:"",time:"14:23",isRead:!0}].forEach((function(o){var i=document.createElement("button");i.classList.add("chat-item"),i.setAttribute("data-chat-id",o.id);var r=c(o.id),d=r.length>0?r[r.length-1]:{text:"Нет сообщений",time:""};i.innerHTML='\n        <div class="chat-info-wrp">\n            <img src="'.concat(o.avatar,'" alt="Аватарка">\n            <div class="chat-info">\n                <h3>').concat(o.title,"</h3>\n                <div data-currentChat=").concat(o.id,">").concat(d.name||d.text,'</div> \n            </div>\n        </div>\n        <div class="chat-time">\n            <span>').concat(d.time||"","</span> \n            ").concat(o.isRead?'<span class="read-status">✓✓</span>':"","\n        </div>"),i.addEventListener("click",(function(){return function(e,o){!function(e){localStorage.setItem("currentChat",e)}(e);var i=document.getElementById("floating-button-component");i&&(i.style.display="none");document.getElementById("chat-list-component").style.display="none",document.getElementById("menu-button").style.display="block";var r=document.createElement("div");r.classList.add("chat-window","center"),r.innerHTML='\n            <div class="chat-header">\n                <button class="back-button"><img src="./static/images/arrow-back.svg" alt="Вернуться к списку чатов"></button>\n            </div>\n            <div class="messages-container"></div>\n        \n            <form class="form" action="/">\n                <textarea class="form-input" name="message-text" placeholder="Введите сообщение" type="text"></textarea>\n                <button class="attach"><img src="./static/images/attach-file-icon.svg" alt="Добавление файла"></button>\n                <button type="submit"><img src="./static/images/send-icon.svg" alt="Отправка сообщения"></button>\n                <div class="attached-file-info" style="display: none;"></div> \x3c!-- Для отображения прикрепленного файла --\x3e\n                <input type="file" id="file-input" style="display: none;" /> \x3c!-- Поле для выбора файла --\x3e\n            </form>',document.querySelector(".header_title-text").textContent=o,document.getElementById("header-component").insertAdjacentElement("afterend",r),r.querySelector(".back-button").addEventListener("click",n),function(e){var t=c(e),n=document.querySelector(".messages-container");t.forEach((function(e){return l(e,n)})),n.scrollTop=n.scrollHeight}(e);var d=r.querySelector("form"),u=r.querySelector("#file-input"),m=r.querySelector(".attach"),g=r.querySelector(".attached-file-info");m.addEventListener("click",(function(e){e.preventDefault(),u.click()})),u.addEventListener("change",(function(e){if((t=e.target.files[0])&&t.size>5e6)return alert("Файл слишком большой для загрузки. Должен быть меньше 5 МБ"),void(t=null);t&&(g.textContent="Файл: ".concat(t.name," прикреплен"),g.style.display="block",g.style.position="absolute",g.style.bottom="48px")})),d.addEventListener("submit",(function(n){n.preventDefault();var c=d.querySelector("textarea").value.trim(),o=document.querySelector(".messages-container");if(c||t)if(t){var i=new FileReader;i.readAsDataURL(t),i.onload=function(){var n={text:c||"",time:(new Date).toLocaleTimeString(),file:i.result};a(e,n),l(n,o),d.querySelector("textarea").value="",t=null,g.style.display="none"}}else{var r={text:c||"",time:(new Date).toLocaleTimeString(),file:null};a(e,r),l(r,o),d.querySelector("textarea").value=""}})),d.addEventListener("keypress",s),document.getElementById("clear-local-storage").addEventListener("click",(function(){var e=getCurrentChat();e&&(localStorage.removeItem("messages_".concat(e)),document.querySelector(".messages-container").innerHTML="")}))}(o.id,o.title)})),e.appendChild(i)})),e}()),p.appendChild(((g=document.createElement("button")).classList.add("floating-button"),g.innerHTML='<img src="./static/images/create-chat.svg" alt="Создать чат">',g.onclick=function(){},g)),document.addEventListener("DOMContentLoaded",(function(){y();var e=document.querySelector("form"),t=document.querySelector(".form-input");e&&t&&(e.addEventListener("submit",i),e.addEventListener("keypress",s))}))}]);